<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Sprout: Stochastic Forecasts Achieve High Throughput and Low Delay over Cellular Networks</title>
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sprout is an end-to-end transport protocol for interactive applications that desire high throughput and low delay, such as
videoconferencing.">
    <meta name="author" content="Keith Winstein <keithw@mit.edu>">

    <!-- Le styles -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .callout {
      }
      .hero-titles {
        padding-bottom: 5%;
      }
      .logo {
        padding: 8px;
      }
      .prelike {
      display: block;
      padding: 8.5px;
      margin: 0 0 9px;
      font-size: 12.025px;
      line-height: 18px;
      background-color: #f5f5f5;
      border: 1px solid #ccc;
      border: 1px solid rgba(0, 0, 0, 0.15);
      -webkit-border-radius: 4px;
      -moz-border-radius: 4px;
      border-radius: 4px;
      word-break: break-all;
      word-wrap: break-word;
      }
      tr.os td {
      vertical-align: bottom;
      }
      tr.inst td {
      vertical-align: top;
      }
    </style>
    <link href="assets/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="assets/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-57-precomposed.png">
  </head>

  <body data-spy="scroll">

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">Sprout</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="#about">About</a></li>
              <li><a href="#paper">Paper</a></li>
              <li><a href="#code">Code</a></li>
              <li><a href="#methods">Methods</a></li>
              <li><a href="#results">Results</a></li>
              <li><a href="#contact">Contact</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">

      <section id="about">
	<div class="hero-unit">
	  <div class="row">
	    <div class="span5">
	      <p><h1>Sprout</h1></p>

	      <p>Sprout is a transport protocol for interactive
		applications that desire high throughput and low
		delay.</p>

	      <p>In evaluations on traces from commercial LTE and 3G
		networks, Sprout achieved <strong>2&ndash;4
		  times</strong> the throughput of Skype, Apple
		Facetime, and Google Hangout, while reducing
		self-inflicted delay by <strong>7&ndash;9 times</strong>.</p>
		
	      <p><small>&mdash; Keith Winstein, Anirudh Sivaraman,
		  and Hari Balakrishnan</small></p>

	      <p><a class="btn btn-primary btn-large" href="#paper">Research paper &raquo;</a>
		<a class="btn btn-primary btn-large" href="#video">Tech video &raquo;</a>
		<a class="btn btn-primary btn-large" href="#code">Source code &raquo;</a></p>

	    </div>

	    <div class="span5">
	      <img src="sproutgraph2.png">
	    </div>
	  </div>
	</div>
	
      </section>
      
      <section id="paper">
	<div class="page-header">
	  <h1>Research paper</h1>
	</div>

	  <p><a href="https://www.usenix.org/system/files/conference/nsdi13/nsdi13-final113.pdf"><img src="pdf.png">Stochastic Forecasts Achieve High Throughput and Low Delay over Cellular Networks</a>, in the proceedings of the 10th USENIX Symposium on Networked Systems Design and Implementation (NSDI 2013), Lombard, Ill., April 2013.</p>

	  <p>Slides and a public summary are <a href="https://www.usenix.org/conference/nsdi13/stochastic-forecasts-achieve-high-throughput-and-low-delay-over-cellular-networks">available on the open-access conference proceedings site</a>.</p>

      </section>

      <section id="video">
	<div class="page-header">
	  <h1>Tech video</h1>
	</div>

	<p>The talk was given April 5, 2013.</p>
	
	<div class="row">
	  <div class="span10">
	    <iframe width="560" height="315" src="https://www.youtube.com/embed/FUgdF-2V8Cw" frameborder="0" allowfullscreen></iframe>
	  </div>
	</div>
      </section>

      <section id="code">
	<div class="page-header">
	  <h1>Code</h1>
	</div>

	  <p>The source code to Sprout (evaluated in the research paper) is <a href="https://github.com/keithw/alfalfa">available on GitHub.</a></p>

          <p>Source code to Sprout Tunnel (allows TCP to be tunneled within Sprout) <a href="https://github.com/anirudhSK/alfalfa"> available on GitHub </a> </p>

	  <p>Our "explicit-state" MPEG-2 implementation includes an <a href="https://github.com/keithw/mympeg2enc">encoder API (based on mpeg2enc)</a> and a <a href="https://github.com/keithw/ahab">decoder API (built around libmpeg2)</a>.</p>

	  <p>Our code for saturating wireless networks and then replaying those traces on a hardware gateway is also <a href="https://github.com/keithw/multisend/tree/master/sender">available on GitHub.</a></p>

	  <p>Our implementation of the "CoDel" AQM algorithm <a href="https://github.com/anirudhSK/cell-codel/blob/master/codel-for-cellsim/delay-queue.cc">is available in a different repository.</a></p>
      </section>

      <section id="methods">
	<div class="page-header">
	  <h1>Methods</h1>
	</div>

	<h2>Data Collection</h2>

	<p>Cellular network traces were collected while driving in
Boston, Mass., and surrounding municipalities. We simultaneously
saturated the uplink and downlink of an Android smartphone tethered to
a Linux laptop and measured the times when packets arrived across each
link. Uplink datagrams were sent to a server at MIT, generally less
than 50 ms RTT from the carrier's first/last hop.</p>

	<p>The code for the <a href="https://github.com/keithw/multisend/blob/master/sender/saturatr.cc">saturatr</a> can be found on GitHub.</p>

	<p>The Verizon LTE and 1xEV-DO (3G) traces used a Samsung
	Galaxy Nexus  smartphone running Android Ice Cream Sandwich.
	The AT&T trace used a Samsung Galaxy S3 smartphone. The T-Mobile
	trace used a Nexus S smartphone running Android Jelly Bean.</p>

	<p> For each network, raw traces for both the uplink and the downlink
	are available <a href="data/cleaned_traces.zip" >here</a> </p>

        <h2> Raw data used to generate the plots </h2>

        <p> The raw data along with instructions to reproduce all of our results( Figures 7,8 and 9 and the tables in Section 5.6 and 5.7 ) from the raw data are available <a href="data/ReproducingResults.zip">here</a>. Please contact us at alfalfa at mit dot edu in case you have any questions/comments.
        </p>

        <h2> Reproducing our results </h2>

        <p> You will need 3 separate physical machines to reproduce our results:
            <ol>
            <li>The first should have a direct connection to the Internet (henceforth to be referred to as the server).
            <li>The second one (to be referred to as cellsim_machine) should have 2 ethernet cards, one of which is directly connected to the Internet (eth0)
            <li>The third one (to be referred to as the client) should have one Ethernet card and its ethernet cable should be connected into the second ethernet card (eth1) of cellsim_machine. As described in the paper, cellsim_machine routes traffic from the client to the Internet and back.
            </ol>
        </p>

        <h3> Cellsim machine instructions </h3>
            Once, the hardware setup is done, do the following on cellsim_machine:
            <ol>
            <li> Download the source for cellsim, our trace driven emulator from here : <a href="https://github.com/keithw/multisend/archive/evaluated.zip">here</a>
            <li> cd into the sender directory and run make cellsim ( You 'll need C++11 support ). This will create the cellsim executable.
            <li> Ensure both ethernet interfaces on cellsim_machine are UP and set to promiscous mode. To do this, run :<pre> sudo ifconfig ethX up promisc </pre>
            <li> Turn off all segmentation offloads on both interfaces using :
                 <pre> sudo ethtool --offload ethX gso off  tso off gro off </pre>
            <li> Run :
                 <pre> sudo ./cellsim uplink_trace downlink_trace client_mac loss_rate </pre> where :
                <ol>
                <li> uplink_trace is a cellular network trace for the uplink.
                <li> downlink_trace is a cellular network trace for the downlink.
                <li> client_mac is the MAC address of the client machine (ie the third machine in the description above).
                <li> loss_rate simulates probabilistic head drop and is a fraction between 0 and 1.
                <li> NOTE: Both uplink_trace and downlink_trace need timestamps in milliseconds that start from zero for cellsim to function properly. The traces <a href="data/cleaned_traces.zip" >here</a>
                have absolute UNIX timestamps in nanoseconds which need to be converted to relative timestamps before feeding them to cellsim.
                <li> NOTE2: The interface connected to the Internet is hard coded as eth0 and the interface connected to the client is hardcoded as eth1. If you have different names on your machine,
                you will need to change both in cellsim.cc.
                </ol>
            <li> Once cellsim is running, it produces a sequence of packet deliveries in both the uplink and the downlink direction. These can be analysed using the scorer and quantiles scripts
            as described <a href="data/ReproducingResults.zip" >here</a>
            </ol>

        <h3> Client/Server machine instructions </h3>
            <p>
            Cellsim is designed to operate transparently. So, you should be able to run pretty much anything on the client so long as the client has a public IP. In particular, you can setup TCP connections
            using different congestion control algorithms on Windows and Linux. To set the congestion control algorithm in Linux on either the client or the server, run(as root). (Replace vegas with cubic
            for TCP cubic.)
<pre> modprobe tcp_vegas
 echo "vegas" > /proc/sys/net/ipv4/tcp_congestion_control
</pre>
            </p>

             <p>
            To enable, Compound TCP on Windows 7, run the following on an elevated command prompt :
             <pre> netsh int tcp set global congestionprovider=ctcp</pre>
             </p>

            <p>
            Our version of LEDBAT is taken from the libutp implementation, available <a href="https://github.com/bittorrent/libutp" > here </a>
            </p>

        <h3> Running CoDel </h3>
            <p>
            Our version of cellsim, with CoDel integrated into it is available <a href="https://github.com/anirudhSK/cell-codel/archive/evaluated.zip" > here </a>. cd into codel-for-cellsim and run
            make cell-codel-sim ( you ll need C++11 support). Then, run : <pre> sudo ./cell-codel-sim uplink_trace downlink_trace client_mac codel_enable </pre> Set codel_enable to 1 or 0 depending
            on whether you want it enabled. Running it with 0 is equivalent to running the original cellsim. uplink_trace, downlink_trace and client_mac have the same interpretations as for cellsim.
            </p>

        <h3> Running Sprout </h3>
            The version of Sprout that was evaluated in the paper is available : <a href="https://github.com/keithw/alfalfa/archive/evaluated-final.zip"> here </a>.
            You will need to install the following libraries to build Sprout:
            <pre> sudo apt-get install libboost-math1.50-dev libboost-math1.50.0 libprotobuf7 libprotobuf-dev </pre>
            Next, cd into alfalfa, and run:
<pre> ./autogen.sh
 ./configure --enable-examples
 make
</pre>
            The Sprout executable should now available at src/examples/sproutbt2. To run the Sprout server, type :<pre> ./sproutbt2 </pre> To run the Sprout client, type :<pre> ./sproutbt2 server_address 60001 </pre> Sprout might need between 20 and 40 seconds to start up (to precompute Gaussian Distributions required for inference).

	<h2>Evaluation of Systems</h2>

	<p>We used a physical gateway computer, with two Ethernet interfaces,
	  to replay the recordings from cellular networks. The gateway
	  queued incoming packets indefinitely, and released them to
	  the other interface according to the schedule previously recorded
	  in the trace.</p>

	<p>The code for
	the <a href="https://github.com/keithw/multisend/blob/master/sender/cellsim.cc">cellsim</a>
	tool (used to replay traces from the saturatr) can be found on
	GitHub.</p>

	<p>We evaluated videoconferencing systems and TCP variants with one
	  computer connected directly to a gigabit switch and to the Internet.
	  The other computer was connected to the cellsim, whose other Ethernet
	  interface was connected to the same gigabit switch.</p>

	<p>We tested the following configurations:

	<table>
	  <tr><th>Program</th><th>Version</th><th>OS</th><th>Endpoints</th></tr>
	  <tr><td>Sprout</td><td>"evaluated" and "ewma-evaluated" tags</td><td>Linux 3.2.0-29-generic (Ubuntu 12.04 LTS)</td><td>Intel Core i7 PC</td></tr>
	  <tr><td>Skype</td><td>5.10.0.116</td><td>Windows 7</td><td>Intel Core i7 PC</td></tr>
	  <tr><td>Google Hangout</td><td>in Chrome 21.0.1180.89</td><td>Windows 7</td><td>Intel Core i7 PC</td></tr>
	  <tr><td>Apple Facetime</td><td>2.0 (1070)</td><td>OS X 10.8.1</td><td>MacBook Pro (2.3 GHz i7), MacBook Air (1.8 GHz i5)</td></tr>
	  <tr><td>TCP CUBIC</td><td>in Linux 3.2.0</td><td></td><td>Intel Core i7 PC</td></tr>
	  <tr><td>TCP Vegas</td><td>in Linux 3.2.0</td><td></td><td>Intel Core i7 PC</td></tr>
	  <tr><td>LEDBAT</td><td>in uTP</td><td>Linux 3.2.0</td><td>Intel Core i7 PC</td></tr>
	  <tr><td>COMPOUND TCP</td><td>in Windows 7</td><td></td><td>Intel Core i7 PC</td></tr>
	</table>

      </section>

      <section id="contact">
	<div class="page-header">
	  <h1>Contact</h1>
	</div>

	Please e-mail alfalfa at mit dot edu with any questions.

      </section>

    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
  </body>
</html>
